{"version":3,"sources":["../../src/routes/straightWagerSubmit.js"],"names":["router","Router","use","sportId","oddHeader","JSON_ODD_KEY","post","authenticate","session","req","res","body","passcode","user","wagerSubmit","latestStraightOddArr","Promise","all","map","wager","wagerIdx","method","eventID","BetDetail","SiteID","Sport","OddType","headers","result","json","odd","latestWager","prevBetDetail","length","newOdd","OddDetail","Odds","BetType","OddTeamSide","OddTarget","HomeTeam","OddPoint","OddLine","MoneyLineHome","Pitcher","HomePitcher","AwayTeam","MoneyLineAway","AwayPitcher","PointSpreadHome","PointSpreadHomeLine","PointSpreadAway","PointSpreadAwayLine","TotalNumber","OverLine","UnderLine","push","then","allOddsAreUpToDate","every","event","JSON","stringify","eventIdx","newStraightOpenBet","betType","agent","superAgent","playerUsername","username","orderStatus","orderTimePST","unix","save","type","isEmpty","WagerDetail","BetAmountInput","BetWagerType","BetConfirm","estWinAmount","estRiskAmount","wagerMsg","errMsg","payload","msg"],"mappings":"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","file":"straightWagerSubmit.js","sourcesContent":["import express from 'express';\nconst router = express.Router();\nimport _ from 'lodash';\nimport fetch from 'node-fetch';\nimport moment from 'moment';\nimport JwtStrategy from '../middleware/jwtStrategy';\nimport passport from \"passport\";\nimport StraightOpenBetWager from '../models/StraightOpenBetWager';\npassport.use(JwtStrategy);\n\nconst sportId = ['MLB', 'NBA', 'NCAAB', 'NCAAF', 'NFL', 'NHL', 'unknowSport', 'SOCCER', 'WNBA', 'TENNIS', 'BOXING', 'MMA', 'CRICKET', 'HORSE-RACING', 'KHL', 'AHL', 'SHL', 'HALL', 'LMP', 'NPB', 'KBO', 'GOLF', 'RUGBY', 'WBC'];\n\nimport config from '../data/config';\nconst oddHeader = { 'JsonOdds-API-Key': config.JSON_ODD_KEY, 'Content-Type': 'application/x-www-form-urlencoded' };\n\nrouter.post('/straight-wager-submit', passport.authenticate('jwt', {session: false}), function(req, res){\n\tif(req.body.passcode === req.user.passcode){\n\t\tconst wagerSubmit = req.body.wagerSubmit;\n\t\tconst latestStraightOddArr = [];\n\n\t\tPromise.all(wagerSubmit.map(async function(wager, wagerIdx){\n\t\t\tconst result = await fetch('https://jsonodds.com/api/odds/bygames', {method: 'POST', body: `GameIDs=${wager.eventID}&Source=${wager.BetDetail.SiteID}&Sport=${sportId[wager.Sport]}&OddType=${wager.BetDetail.OddType}`, headers: oddHeader})\n\t\t\tconst odd = await result.json();\n\t\t\tconst latestWager = wager\n\t\t\tlatestWager.prevBetDetail = wager.BetDetail\n\t\t\tlatestWager.BetDetail = {}\n\n\t\t\tif(odd.length > 0){\n\t\t\t\tconst newOdd = odd[0]\n\t\t\t\tnewOdd.OddDetail = newOdd.Odds[0]\n\t\t\t\tdelete newOdd.Odds[0]\n\n\t\t\t\tswitch(true){\n\t\t\t\t\tcase latestWager.prevBetDetail.BetType === 'M Line' && latestWager.prevBetDetail.OddTeamSide === 'Home':\n\t\t\t\t\t\tlatestWager.BetDetail.OddType = newOdd.OddDetail.OddType\n\t\t\t\t\t\tlatestWager.BetDetail.BetType = 'M Line'\n\t\t\t\t\t\tlatestWager.BetDetail.SiteID = newOdd.OddDetail.SiteID\n\t\t\t\t\t\tlatestWager.BetDetail.OddTarget = newOdd.HomeTeam\n\t\t\t\t\t\tlatestWager.BetDetail.OddPoint = ''\n\t\t\t\t\t\tlatestWager.BetDetail.OddLine = newOdd.OddDetail.MoneyLineHome\n\t\t\t\t\t\tlatestWager.BetDetail.OddTeamSide = 'Home'\n\t\t\t\t\t\tlatestWager.BetDetail.Pitcher = newOdd.HomePitcher\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase latestWager.prevBetDetail.BetType === 'M Line' && latestWager.prevBetDetail.OddTeamSide === 'Away':\n\t\t\t\t\t\tlatestWager.BetDetail.OddType = newOdd.OddDetail.OddType\n\t\t\t\t\t\tlatestWager.BetDetail.BetType = 'M Line'\n\t\t\t\t\t\tlatestWager.BetDetail.SiteID = newOdd.OddDetail.SiteID\n\t\t\t\t\t\tlatestWager.BetDetail.OddTarget = newOdd.AwayTeam\n\t\t\t\t\t\tlatestWager.BetDetail.OddPoint = ''\n\t\t\t\t\t\tlatestWager.BetDetail.OddLine = newOdd.OddDetail.MoneyLineAway\n\t\t\t\t\t\tlatestWager.BetDetail.OddTeamSide = 'Away'\n\t\t\t\t\t\tlatestWager.BetDetail.Pitcher = newOdd.AwayPitcher\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase latestWager.prevBetDetail.BetType === 'Spread' && latestWager.prevBetDetail.OddTeamSide === 'Home':\n\t\t\t\t\t\tlatestWager.BetDetail.OddType = newOdd.OddDetail.OddType\n\t\t\t\t\t\tlatestWager.BetDetail.BetType = 'Spread'\n\t\t\t\t\t\tlatestWager.BetDetail.SiteID = newOdd.OddDetail.SiteID\n\t\t\t\t\t\tlatestWager.BetDetail.OddTarget = newOdd.HomeTeam\n\t\t\t\t\t\tlatestWager.BetDetail.OddPoint = newOdd.OddDetail.PointSpreadHome\n\t\t\t\t\t\tlatestWager.BetDetail.OddLine = newOdd.OddDetail.PointSpreadHomeLine\n\t\t\t\t\t\tlatestWager.BetDetail.OddTeamSide = 'Home'\n\t\t\t\t\t\tlatestWager.BetDetail.Pitcher = newOdd.HomePitcher\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase latestWager.prevBetDetail.BetType === 'Spread' && latestWager.prevBetDetail.OddTeamSide === 'Away':\n\t\t\t\t\t\tlatestWager.BetDetail.OddType = newOdd.OddDetail.OddType\n\t\t\t\t\t\tlatestWager.BetDetail.BetType = 'Spread'\n\t\t\t\t\t\tlatestWager.BetDetail.SiteID = newOdd.OddDetail.SiteID\n\t\t\t\t\t\tlatestWager.BetDetail.OddTarget = newOdd.AwayTeam\n\t\t\t\t\t\tlatestWager.BetDetail.OddPoint = newOdd.OddDetail.PointSpreadAway\n\t\t\t\t\t\tlatestWager.BetDetail.OddLine = newOdd.OddDetail.PointSpreadAwayLine\n\t\t\t\t\t\tlatestWager.BetDetail.OddTeamSide = 'Away'\n\t\t\t\t\t\tlatestWager.BetDetail.Pitcher = newOdd.AwayPitcher\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase latestWager.prevBetDetail.BetType === 'Total' && latestWager.prevBetDetail.OddTarget === 'Over':\n\t\t\t\t\t\tlatestWager.BetDetail.OddType = newOdd.OddDetail.OddType\n\t\t\t\t\t\tlatestWager.BetDetail.BetType = 'Total'\n\t\t\t\t\t\tlatestWager.BetDetail.SiteID = newOdd.OddDetail.SiteID\n\t\t\t\t\t\tlatestWager.BetDetail.OddTarget = 'Over'\n\t\t\t\t\t\tlatestWager.BetDetail.OddPoint = newOdd.OddDetail.TotalNumber\n\t\t\t\t\t\tlatestWager.BetDetail.OddLine = newOdd.OddDetail.OverLine\n\t\t\t\t\t\tlatestWager.BetDetail.OddTeamSide = ''\n\t\t\t\t\t\tlatestWager.BetDetail.Pitcher = ''\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase latestWager.prevBetDetail.BetType === 'Total' && latestWager.prevBetDetail.OddTarget === 'Under':\n\t\t\t\t\t\tlatestWager.BetDetail.OddType = newOdd.OddDetail.OddType\n\t\t\t\t\t\tlatestWager.BetDetail.BetType = 'Total'\n\t\t\t\t\t\tlatestWager.BetDetail.SiteID = newOdd.OddDetail.SiteID\n\t\t\t\t\t\tlatestWager.BetDetail.OddTarget = 'Under'\n\t\t\t\t\t\tlatestWager.BetDetail.OddPoint = newOdd.OddDetail.TotalNumber\n\t\t\t\t\t\tlatestWager.BetDetail.OddLine = newOdd.OddDetail.UnderLine\n\t\t\t\t\t\tlatestWager.BetDetail.OddTeamSide = ''\n\t\t\t\t\t\tlatestWager.BetDetail.Pitcher = ''\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tlatestStraightOddArr.push(latestWager)\n\t\t\t}else{\n\t\t\t\tlatestStraightOddArr.push(latestWager)\n\t\t\t}\n\t\t})).then(function(){\n\t\t\tconst allOddsAreUpToDate = latestStraightOddArr.every((event) => JSON.stringify(event.BetDetail) === JSON.stringify(event.prevBetDetail))\n\t\t\tif(allOddsAreUpToDate){\n\t\t\t\tPromise.all(latestStraightOddArr.map(async function(event, eventIdx){\n\t\t\t\t\tdelete event.prevBetDetail\n\t\t\t\t\tlet newStraightOpenBet = new StraightOpenBetWager({\n\t\t\t\t\t\tbetType: 'straight',\n\t\t\t\t\t\tagent: req.user.agent,\t// who is agent\n\t\t\t\t\t\tsuperAgent: req.user.superAgent,\n\t\t\t\t\t\tplayerUsername: req.user.username,\n\t\t\t\t\t\tevent: event,\n\t\t\t\t\t\torderStatus: 'open', // open / cancelled\n\t\t\t\t\t\torderTimePST: moment().unix() // use 0 UTC\n\t\t\t\t\t});\n\t\t\t\t\tawait newStraightOpenBet.save()\n\t\t\t\t})).then(function(){\n\t\t\t\t\tres.json({type: 'SERVER_OPEN_BET_SAVED'})\n\t\t\t\t})\n\t\t\t}else{\n\t\t\t\tlatestStraightOddArr.map(function(event, eventIdx){\n\t\t\t\t\tif(!_.isEmpty(event.BetDetail) && !_.isEmpty(event.prevBetDetail)){\n\t\t\t\t\t\tif(JSON.stringify(event.BetDetail) === JSON.stringify(event.prevBetDetail)){\n\t\t\t\t\t\t\tdelete event.prevBetDetail\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tevent.WagerDetail = {\n\t\t\t\t\t\t\t\tBetAmountInput: '', \n\t\t\t\t\t\t\t\tBetWagerType: 'Wager', \n\t\t\t\t\t\t\t\tBetConfirm: false, \n\t\t\t\t\t\t\t\testWinAmount: '0', \n\t\t\t\t\t\t\t\testRiskAmount: '0',\n\t\t\t\t\t\t\t\twagerMsg: '', \n\t\t\t\t\t\t\t\terrMsg: 'wager has changed'\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}else if(_.isEmpty(event.BetDetail)){\n\t\t\t\t\t\tevent.WagerDetail = {\n\t\t\t\t\t\t\tBetAmountInput: '', \n\t\t\t\t\t\t\tBetWagerType: 'Wager', \n\t\t\t\t\t\t\tBetConfirm: false, \n\t\t\t\t\t\t\testWinAmount: '0', \n\t\t\t\t\t\t\testRiskAmount: '0',\n\t\t\t\t\t\t\twagerMsg: '', \n\t\t\t\t\t\t\terrMsg: 'event has been started, remove it'\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\treturn event\n\t\t\t\t})\n\t\t\t\tres.json({type: 'SERVER_LATEST_ODD_UPDATE', payload: latestStraightOddArr})\n\t\t\t}\n\t\t})\n\t}else{\n\t\tres.json({type: 'SERVER_PASSCODE_NOT_MATCH', msg: 'passcode not match'})\n\t}\n})\n\nexport default router\n\n"]}